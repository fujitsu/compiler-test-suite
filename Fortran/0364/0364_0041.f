      SUBROUTINE TEST(ND,IND,DIFF,POL,LVEC)
      PARAMETER(NSTEPS=200,NDMAX=10)
      REAL*8 CD0,CD1,CD2,CD3
      REAL*8 DIFF,POL
      COMMON/BESS1/CD0(0:NSTEPS,2:NDMAX),CD1(0:NSTEPS,2:NDMAX)
      COMMON/BESS2/CD2(0:NSTEPS,2:NDMAX),CD3(0:NSTEPS,2:NDMAX)
      DIMENSION IND(LVEC),DIFF(LVEC),POL(LVEC)
      DO 10 I=2,LVEC,2
      POL(I-1)=
     X     ( CD0(IND(I-1),ND)+DIFF(I-1)*( CD1(IND(I-1),ND)+DIFF(I-1)*
     X     ( CD2(IND(I-1),ND)+DIFF(I-1)*  CD3(IND(I-1),ND) )))
      POL(I)=( CD0(IND(I),ND)+DIFF(I)*( CD1(IND(I),ND)+DIFF(I)*
     X       ( CD2(IND(I),ND)+DIFF(I)*  CD3(IND(I),ND) )))
10    CONTINUE
      END
C
      PROGRAM MAIN
C
      PARAMETER(MAXVEC=4**3*8,NDMAX=10,NDMAX4=8)
C
      INTEGER RES
      REAL*8 BCOEFF,RD,SD,RESULT
      REAL*8 B1,B2,B3,B4,PLINT,W1,W2,TRACE,BSQ,D1,D2,D3,D4
      REAL*8 SUM1,SUM2,CHIDM1,CHID,BES1,BES2,BES3,BES4,F6
      REAL*8 B1SQ,B2SQ,B3SQ,B4SQ,CHIOLD,F5,ZERO,ONE,TWO
      PARAMETER(ZERO=0.D0,ONE=1.D0,TWO=2.D0)
C
      COMMON LVEC
      COMMON/BESS3/RD(NDMAX)
      COMMON/BESS4/BCOEFF
C
      DIMENSION B1(MAXVEC,0:3),B2(MAXVEC,0:3)
      DIMENSION B3(MAXVEC,0:3),B4(MAXVEC,0:3),PLINT(MAXVEC)
C
      DIMENSION W1(MAXVEC,0:3),W2(MAXVEC,0:3),TRACE(MAXVEC),BSQ(MAXVEC)
      DIMENSION D1(MAXVEC),D2(MAXVEC),D3(MAXVEC),D4(MAXVEC)
      DIMENSION I1(MAXVEC),I2(MAXVEC),I3(MAXVEC),I4(MAXVEC),SD(MAXVEC)
      DIMENSION SUM1(MAXVEC),SUM2(MAXVEC),CHIDM1(MAXVEC),CHID(MAXVEC)
      DIMENSION BES1(MAXVEC),BES2(MAXVEC),BES3(MAXVEC),BES4(MAXVEC)
      DIMENSION F6(MAXVEC)
      LVEC  = 10
      CALL INTIALIZE(W1,W2,B1,B2,B3,B4,PLINT,SD)
C
      DO 50 I=1,LVEC
C
        TRACE(I)=TWO*( W1(I,0)*W2(I,0) + W1(I,1)*W2(I,1)
     X               + W1(I,2)*W2(I,2) + W1(I,3)*W2(I,3) )
C
        B1SQ=B1(I,0)**2 + B1(I,1)**2 + B1(I,2)**2 + B1(I,3)**2
        B2SQ=B2(I,0)**2 + B2(I,1)**2 + B2(I,2)**2 + B2(I,3)**2
        B3SQ=B3(I,0)**2 + B3(I,1)**2 + B3(I,2)**2 + B3(I,3)**2
        B4SQ=B4(I,0)**2 + B4(I,1)**2 + B4(I,2)**2 + B4(I,3)**2

        BSQ(I)=B1SQ*B2SQ*B3SQ*B4SQ
        D1(I)=BCOEFF*B1SQ
        I1(I)=D1(I)
        D1(I)=D1(I)-I1(I)
        D2(I)=BCOEFF*B2SQ
        I2(I)=D2(I)
        D2(I)=D2(I)-I2(I)
        D3(I)=BCOEFF*B3SQ
        I3(I)=D3(I)
        D3(I)=D3(I)-I3(I)
        D4(I)=BCOEFF*B4SQ
        I4(I)=D4(I)
        D4(I)=D4(I)-I4(I)
        SUM1(I)=SD(1)
        SUM2(I)=ONE
        CHIDM1(I)=ZERO
        CHID(I)=ONE
50    CONTINUE
C
      DO 100 ND=2,NDMAX4
        CALL TEST(ND,I1,D1,BES1,LVEC)
        CALL TEST(ND,I2,D2,BES2,LVEC)
        CALL TEST(ND,I3,D3,BES3,LVEC)
        CALL TEST(ND,I4,D4,BES4,LVEC)
        DO 150 I=1,LVEC
          CHIOLD=CHIDM1(I)
          CHIDM1(I)=CHID(I)
          CHID(I)=TRACE(I)*CHID(I) - BSQ(I)*CHIOLD
          F5=CHID(I)*BES1(I)*BES2(I)*BES3(I)*BES4(I)
          F6(I)=RD(ND)*F5
          SUM1(I)=SUM1(I) + SD(ND)*F5
          SUM2(I)=SUM2(I) + F6(I)
150     CONTINUE
100   CONTINUE
      DO 200 I=1,LVEC
        PLINT(I)=SUM1(I)*SUM2(I)
200   CONTINUE
      RESULT = 0.0
      DO 300 I=1,LVEC
        RESULT = RESULT+PLINT(I)
300   CONTINUE
      WRITE(6,*) RESULT
      RES = RESULT
      IF ( RES .EQ. 30 ) THEN
        WRITE(6,*) 'TEST  OK '
      ELSE
        WRITE(6,*) 'TEST  NG '
      ENDIF 
      END
C
       SUBROUTINE INTIALIZE(W1,W2,B1,B2,B3,B4,PLINT,SD)
       PARAMETER(MAXVEC=4**3*8)
       REAL*8 B1(MAXVEC,0:3),B2(MAXVEC,0:3)
       REAL*8 B3(MAXVEC,0:3),B4(MAXVEC,0:3),PLINT(MAXVEC),SD(MAXVEC)
       REAL*8 W1(MAXVEC,0:3),W2(MAXVEC,0:3)

       DO 1000 I=1,MAXVEC
         PLINT(I) = 1.0
         SD(I)    = 3.0
         DO 1000 J=0,3
           B1(I,J) = 1.0
           B2(I,J) = 2.0
           B3(I,J) = 3.0
           B4(I,J) = 5.0
           W1(I,J) = 2.0
           W2(I,J) = 2.0
 1000 CONTINUE
      RETURN
      END
