MODULE M1
TYPE NODE
INTEGER,ALLOCATABLE :: VALUE
CLASS (NODE), ALLOCATABLE :: NEXT_NODE
CLASS (NODE), ALLOCATABLE :: PREV_NODE

CONTAINS
PROCEDURE,PASS::VERIFY => RECURSIVE_CALL
END TYPE

TYPE,EXTENDS(NODE)::EXT
INTEGER,ALLOCATABLE :: II
END TYPE

CONTAINS
FUNCTION RECURSIVE_CALL (THIS)
CLASS(NODE) :: THIS
TYPE(NODE)  :: RECURSIVE_CALL

RECURSIVE_CALL = THIS

if (RECURSIVE_CALL%NEXT_NODE%VALUE /= 21) print*, 201
if (RECURSIVE_CALL%NEXT_NODE%PREV_NODE%VALUE /= 22) print*, 202
if (RECURSIVE_CALL%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 23) print*, 203

if (RECURSIVE_CALL%PREV_NODE%VALUE /= 24) print*, 204
if (RECURSIVE_CALL%PREV_NODE%NEXT_NODE%VALUE /= 25) print*, 205
if (RECURSIVE_CALL%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 26) print*, 206
END FUNCTION
END MODULE

USE M1

TYPE(NODE),ALLOCATABLE :: OBJ
TYPE(NODE),ALLOCATABLE :: OBJ2

ALLOCATE(OBJ)
ALLOCATE(OBJ%NEXT_NODE)
ALLOCATE(OBJ%NEXT_NODE%VALUE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

OBJ%NEXT_NODE%VALUE = 10
OBJ%NEXT_NODE%PREV_NODE%VALUE = 11
OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 12

ALLOCATE(OBJ%PREV_NODE)
ALLOCATE(OBJ%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ%PREV_NODE%NEXT_NODE%PREV_NODE)

ALLOCATE(OBJ2)
ALLOCATE(OBJ2%NEXT_NODE)
ALLOCATE(OBJ2%NEXT_NODE%VALUE)
ALLOCATE(EXT::OBJ2%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

OBJ2%NEXT_NODE%VALUE = 21
OBJ2%NEXT_NODE%PREV_NODE%VALUE = 22
OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 23

ALLOCATE(OBJ2%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%VALUE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%VALUE)
ALLOCATE(EXT::OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE)

OBJ2%PREV_NODE%VALUE = 24
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 25
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 26

OBJ = OBJ2

OBJ2%NEXT_NODE%VALUE = 31
OBJ2%NEXT_NODE%PREV_NODE%VALUE = 32
OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 33

OBJ2%PREV_NODE%VALUE = 34
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 35
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 36

if (OBJ%NEXT_NODE%VALUE /= 21) print*, 101
if (OBJ%NEXT_NODE%PREV_NODE%VALUE /= 22) print*, 102
if (OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 23) print*, 103

if (OBJ%PREV_NODE%VALUE /= 24) print*, 104
if (OBJ%PREV_NODE%NEXT_NODE%VALUE /= 25) print*, 105
if (OBJ%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 26) print*, 106

SELECT TYPE(X=>OBJ%NEXT_NODE%PREV_NODE)
 TYPE IS(EXT)
 CLASS DEFAULT
  PRINT*,911
END SELECT

SELECT TYPE(X=>OBJ%PREV_NODE%NEXT_NODE%PREV_NODE)
 TYPE IS(EXT)
 CLASS DEFAULT
  PRINT*,912
END SELECT

SELECT TYPE(X=>OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE)
 TYPE IS(NODE)
 CLASS DEFAULT
  PRINT*,911
END SELECT

print*,"PASS"
END
