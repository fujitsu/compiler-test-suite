MODULE MOD1
TYPE NODE
INTEGER,ALLOCATABLE :: VALUE
TYPE (NODE), ALLOCATABLE :: NEXT_NODE
TYPE (NODE), ALLOCATABLE :: PREV_NODE
END TYPE

TYPE(NODE) :: OBJ
TYPE(NODE) :: OBJ2
END MODULE

PROGRAM MAIN
USE MOD1

CALL SUB1()
CALL SUB2()

CONTAINS
SUBROUTINE SUB1()
ALLOCATE(OBJ%NEXT_NODE)
ALLOCATE(OBJ%NEXT_NODE%VALUE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

ALLOCATE(OBJ%PREV_NODE)
ALLOCATE(OBJ%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ%PREV_NODE%NEXT_NODE%PREV_NODE)

OBJ%NEXT_NODE%VALUE = 10
OBJ%NEXT_NODE%PREV_NODE%VALUE = 11
OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 12

ALLOCATE(OBJ2%NEXT_NODE)
ALLOCATE(OBJ2%NEXT_NODE%VALUE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

ALLOCATE(OBJ2%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%VALUE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%VALUE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE)

OBJ2%NEXT_NODE%VALUE = 21
OBJ2%NEXT_NODE%PREV_NODE%VALUE = 22
OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 23

OBJ2%PREV_NODE%VALUE = 24
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 25
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 26

OBJ=OBJ2

OBJ2%NEXT_NODE%VALUE = 31
OBJ2%NEXT_NODE%PREV_NODE%VALUE = 32
OBJ2%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 33

OBJ2%PREV_NODE%VALUE = 34
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 35
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 36

if (OBJ%NEXT_NODE%VALUE /= 21) print*, 101
if (OBJ%NEXT_NODE%PREV_NODE%VALUE /= 22) print*, 102
if (OBJ%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 23) print*, 103
if (OBJ%PREV_NODE%VALUE /= 24) print*, 104
if (OBJ%PREV_NODE%NEXT_NODE%VALUE /= 25) print*, 105
if (OBJ%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 26) print*, 106
print*,"PASS"
END SUBROUTINE

SUBROUTINE SUB2()
TYPE NODE1
TYPE (NODE1), ALLOCATABLE :: NEXT_NODE
INTEGER :: VALUE
TYPE (NODE1), ALLOCATABLE :: PREV_NODE
END TYPE

TYPE(NODE1) :: OBJ1
TYPE(NODE1) :: OBJ2

ALLOCATE(OBJ1%NEXT_NODE)
ALLOCATE(OBJ1%NEXT_NODE%NEXT_NODE)
ALLOCATE(OBJ1%NEXT_NODE%NEXT_NODE%NEXT_NODE)

ALLOCATE(OBJ1%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ1%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ1%NEXT_NODE%PREV_NODE%NEXT_NODE%PREV_NODE)

ALLOCATE(OBJ2%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%PREV_NODE%PREV_NODE)

ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE)

OBJ2%PREV_NODE%VALUE = 41
OBJ2%PREV_NODE%PREV_NODE%VALUE = 42
OBJ2%PREV_NODE%PREV_NODE%PREV_NODE%VALUE = 43
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 44
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 45
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 46

OBJ1 = OBJ2

OBJ2%PREV_NODE%VALUE = 51
OBJ2%PREV_NODE%PREV_NODE%VALUE = 52
OBJ2%PREV_NODE%PREV_NODE%PREV_NODE%VALUE = 53
OBJ2%PREV_NODE%NEXT_NODE%VALUE = 54
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 55
OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 56

if(OBJ1%PREV_NODE%VALUE /= 41) print*, 301
if(OBJ1%PREV_NODE%PREV_NODE%VALUE /= 42) print*, 302
if(OBJ1%PREV_NODE%PREV_NODE%PREV_NODE%VALUE /= 43) print*, 303
if(OBJ1%PREV_NODE%NEXT_NODE%VALUE /= 44) print*, 304
if(OBJ1%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 45) print*, 305
if(OBJ1%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 46) print*, 306
 
OBJ2 = OBJ1

OBJ1%PREV_NODE%VALUE = 61
OBJ1%PREV_NODE%PREV_NODE%VALUE = 62
OBJ1%PREV_NODE%PREV_NODE%PREV_NODE%VALUE = 63
OBJ1%PREV_NODE%NEXT_NODE%VALUE = 64
OBJ1%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 65
OBJ1%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 66

if(OBJ2%PREV_NODE%VALUE /= 41) print*, 401
if(OBJ2%PREV_NODE%PREV_NODE%VALUE /= 42) print*, 402
if(OBJ2%PREV_NODE%PREV_NODE%PREV_NODE%VALUE /= 43) print*, 403
if(OBJ2%PREV_NODE%NEXT_NODE%VALUE /= 44) print*, 404
if(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 45) print*, 405
if(OBJ2%PREV_NODE%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 46) print*, 406
END SUBROUTINE
END
