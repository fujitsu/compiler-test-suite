MODULE MOD1
TYPE TS
INTEGER,ALLOCATABLE :: CMP(:)
END TYPE

TYPE NODE
INTEGER,ALLOCATABLE :: VALUE
TYPE (NODE), ALLOCATABLE :: NEXT_NODE
TYPE (TS) :: UP_NODE
TYPE (NODE), ALLOCATABLE :: PREV_NODE
END TYPE

TYPE(NODE) :: OBJ(2)
TYPE(NODE) :: OBJ2(3)
END MODULE

PROGRAM MAIN
USE MOD1

ALLOCATE(OBJ(1)%NEXT_NODE)
ALLOCATE(OBJ(1)%NEXT_NODE%VALUE)
ALLOCATE(OBJ(1)%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ(1)%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ(1)%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ(1)%NEXT_NODE%PREV_NODE%NEXT_NODE%UP_NODE%CMP(3))
ALLOCATE(OBJ(1)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

OBJ(1)%NEXT_NODE%VALUE = 10
OBJ(1)%NEXT_NODE%PREV_NODE%VALUE = 11
OBJ(1)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 12

ALLOCATE(OBJ(2)%PREV_NODE)
ALLOCATE(OBJ(2)%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ(2)%PREV_NODE%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ(2)%PREV_NODE%NEXT_NODE%PREV_NODE%UP_NODE%CMP(3))

CALL SUB(OBJ, SIZE(OBJ))

CONTAINS
SUBROUTINE SUB(DMY, N)
TYPE(NODE) :: DMY(N)

ALLOCATE(OBJ2(3)%NEXT_NODE)
ALLOCATE(OBJ2(3)%NEXT_NODE%VALUE)
ALLOCATE(OBJ2(3)%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2(3)%NEXT_NODE%PREV_NODE%VALUE)
ALLOCATE(OBJ2(3)%NEXT_NODE%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2(3)%NEXT_NODE%PREV_NODE%NEXT_NODE%UP_NODE%CMP(4))
ALLOCATE(OBJ2(3)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE)

OBJ2(3)%NEXT_NODE%VALUE = 21
OBJ2(3)%NEXT_NODE%PREV_NODE%VALUE = 22
OBJ2(3)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 23

ALLOCATE(OBJ2(2)%PREV_NODE)
ALLOCATE(OBJ2(2)%PREV_NODE%VALUE)
ALLOCATE(OBJ2(2)%PREV_NODE%NEXT_NODE)
ALLOCATE(OBJ2(2)%PREV_NODE%NEXT_NODE%VALUE)
ALLOCATE(OBJ2(2)%PREV_NODE%NEXT_NODE%PREV_NODE)
ALLOCATE(OBJ2(2)%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE)

OBJ2(2)%PREV_NODE%VALUE = 24
OBJ2(2)%PREV_NODE%NEXT_NODE%VALUE = 25
OBJ2(2)%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 26

DMY = OBJ2(2:3)

OBJ2(3)%NEXT_NODE%VALUE = 31
OBJ2(3)%NEXT_NODE%PREV_NODE%VALUE = 32
OBJ2(3)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE = 33

OBJ2(2)%PREV_NODE%VALUE = 34
OBJ2(2)%PREV_NODE%NEXT_NODE%VALUE = 35
OBJ2(2)%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE = 36

if (SIZE(DMY) /= 2) print*, 901

if (DMY(2)%NEXT_NODE%VALUE /= 21) print*, 101
if (DMY(2)%NEXT_NODE%PREV_NODE%VALUE /= 22) print*, 102
if (DMY(2)%NEXT_NODE%PREV_NODE%NEXT_NODE%VALUE /= 23) print*, 103

if (DMY(1)%PREV_NODE%VALUE /= 24) print*, 104
if (DMY(1)%PREV_NODE%NEXT_NODE%VALUE /= 25) print*, 105
if (DMY(1)%PREV_NODE%NEXT_NODE%PREV_NODE%VALUE /= 26) print*, 106
print*,"PASS"
END SUBROUTINE
END
