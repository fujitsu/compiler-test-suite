MODULE M
  TYPE TY
    INTEGER :: X=9
     REAL :: Y=8
  CONTAINS
    PROCEDURE :: WFORM
     GENERIC :: WRITE(FORMATTED) => WFORM
  END TYPE
    INTEGER::C=1,B=1
   INTEGER,SAVE::AA=1
   CHARACTER(LEN=15)::CH,CH2='A'

CONTAINS
    SUBROUTINE WFORM(DTV, UNIT,IOTYPE,V_LIST, IOSTAT, IOMSG)
     CLASS(TY), INTENT(IN)            :: DTV
    INTEGER, INTENT(IN)            :: UNIT
    CHARACTER(LEN=*), INTENT(IN)    :: IOTYPE
    INTEGER, INTENT(IN)             :: V_LIST (:)
    INTEGER, INTENT(OUT)            :: IOSTAT
    CHARACTER(LEN=*), INTENT(INOUT) :: IOMSG 
     CH=IOTYPE
    IF(SIZE(V_LIST)/=0) THEN
        CH2='VLIST'
        C=V_LIST(1)
        B=V_LIST(2)
        AA=AA+DTV%X
    
      ELSE
         AA=AA+DTV%X
      END IF
      IF(AA .EQ. 20)WRITE(UNIT,*,IOSTAT=IOSTAT,IOMSG=IOMSG)'PASS'
          
              
END SUBROUTINE
END MODULE
PROGRAM MAIN
  USE M

  INTERFACE
  FUNCTION FUN(D)
  IMPORT TY
  TYPE (TY) :: D,FUN
  END FUNCTION
  END INTERFACE

  TYPE (TY) :: T1
  CALL SS(FUN)

  CONTAINS

  SUBROUTINE SS(DFUN)
  INTERFACE
  FUNCTION DFUN(DD)
  IMPORT TY
  TYPE (TY) :: DD,DFUN
  END FUNCTION
  END INTERFACE
  
  PRINT *,DFUN(T1)
           IF(AA .NE. 20)PRINT*,101
  IF(CH .NE. 'LISTDIRECTED')PRINT*,102
  IF(CH2 .EQ. 'VLIST' .AND. (C .NE.2 .AND. B .NE.3))PRINT*,103
  END SUBROUTINE
END PROGRAM

 FUNCTION FUN(D)
  USE M
  TYPE (TY) :: D,FUN
  FUN=D
  FUN%X = FUN%X+10
  FUN%Y = FUN%Y+10
 END FUNCTION

