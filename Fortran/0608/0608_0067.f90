MODULE mod1
TYPE ty
  INTEGER ::ii=2
  INTEGER,ALLOCATABLE :: jj
  CONTAINS
  FINAL::final_proc
END TYPE
CONTAINS
PURE SUBROUTINE final_proc(dmy)
  TYPE(ty),INTENT(INOUT)::dmy(*)
  IF(ALLOCATED(dmy(6)%jj))DEALLOCATE(dmy(6)%jj)
END SUBROUTINE

PURE FUNCTION fun1()
  TYPE(ty)::fun1(2,1,3)
  fun1%ii=1
  fun1(2,1,3)%ii=2
  ALLOCATE(fun1(2,1,3)%jj)
END FUNCTION
END MODULE

PROGRAM MAIN
USE mod1
IMPLICIT NONE
call sub
CONTAINS
SUBROUTINE sub
CHARACTER(LEN=UBOUND(SHAPE(fun1()),1)+4)::bb
bb='TESTINGIU-OK'
IF(bb .eq. 'TESTING')PRINT*,'PASS'
END SUBROUTINE
END
