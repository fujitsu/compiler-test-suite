MODULE mod1
IMPLICIT NONE

TYPE t1
  INTEGER :: n1
END TYPE

TYPE,EXTENDS(t1) :: t2
  INTEGER :: n2
END TYPE

TYPE,EXTENDS(t2) :: t3
  INTEGER :: n3
END TYPE

INTERFACE OPERATOR(.mult.)
  MODULE PROCEDURE multip
END INTERFACE

CONTAINS

FUNCTION multip(dd1,dd2)
IMPLICIT NONE
CLASS(t1),DIMENSION(:,:,:,:,:,:),INTENT(IN) :: dd1
INTEGER,INTENT(IN) :: dd2
CLASS(t1),DIMENSION(:,:,:,:,:,:),ALLOCATABLE :: multip
ALLOCATE(multip(5,6,4,5,3,8))
multip%n1 = dd1%n1 * dd2
END FUNCTION

END MODULE


PROGRAM main
USE mod1
IMPLICIT NONE

INTEGER :: res = 0
CLASS(t1),DIMENSION(:,:,:,:,:,:),POINTER :: ptr
ALLOCATE(ptr(5,6,4,5,3,8))

res = fun_main(ptr)

IF(res .EQ. 1) THEN
  PRINT*,'pass'
ELSE
  PRINT*,101
END IF

CONTAINS

FUNCTION fun_main(dy1)
IMPLICIT NONE

INTEGER :: fun_main
CLASS(t1),DIMENSION(:,:,:,:,:,:) :: dy1

SELECT TYPE(aa => fun_2(dy1) .mult. 2)
  CLASS IS(t3)
    PRINT*,103
  CLASS IS(t1)
    IF(aa(3,3,3,3,3,3)%n1 .EQ. 40) THEN
      fun_main = 1
    ELSE
      fun_main = 0
    END IF
  CLASS DEFAULT
    PRINT*,102
END SELECT

END FUNCTION

FUNCTION fun_2(dd1)
IMPLICIT NONE
CLASS(t1),DIMENSION(:,:,:,:,:,:) :: dd1
CLASS(t1),DIMENSION(:,:,:,:,:,:),ALLOCATABLE :: fun_2
ALLOCATE(fun_2(5,6,4,5,3,8))
dd1%n1 = 20
fun_2%n1 = dd1%n1
END FUNCTION

END PROGRAM

