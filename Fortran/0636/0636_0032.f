      PROGRAM MAIN
      IMPLICIT REAL*8(A-B,D),LOGICAL*4(L),COMPLEX*16(C)
      DIMENSION  DA10(50,50),DA20(50,50),DA30(50,50),DA40(50,50),
     *           LD10(50,50),LD20(50,50)
      COMMON /BLK/ CD10(50,50),CD20(50,50),CD30(50,50)
      DATA     DA10/2500*1.0D0/,DA20/2500*2.0D0/
      DATA     DA30/2500*3.0D0/,DA40/2500*4.0D0/
      DATA     LD10/2500*.FALSE./,LD20/2500*.FALSE./
      DATA     NN/50/
      DX = 1.D0
      DO 10 I=1,50
       DY = DFLOAT(I)
       DO 10 J=1,50
        DZ=DFLOAT(J)
        CD10(I,J)=DCMPLX(DX,DY)
        CD20(I,J)=DCMPLX(DY,DZ)
        CD30(I,J)=DCMPLX(DZ,DX)
  10  CONTINUE
      CALL  SUB1(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      NN=NN/2
      CALL  SUB2(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      WRITE(6,*) 'DA10=',DA10
      WRITE(6,*) 'DA20=',DA20
      WRITE(6,*) 'DA30=',DA30
      WRITE(6,*) 'DA40=',DA40
      WRITE(6,*) 'LD10=',LD10
      WRITE(6,*) 'LD20=',LD20
      WRITE(6,*) 'CD10=',((CD10(I,J),I=1,20),J=1,20)
      WRITE(6,*) 'CD20=',((CD20(I,J),I=1,20),J=1,20)
      WRITE(6,*) 'CD30=',((CD30(I,J),I=1,20),J=1,20)
      STOP
      END
      SUBROUTINE SUB1(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      IMPLICIT  REAL*8(D),LOGICAL*4(L),COMPLEX*16(C)
      DIMENSION  DA10(NN,NN),DA20(NN,NN),DA30(NN,NN),DA40(NN,NN),
     *           LD10(NN,NN),LD20(NN,NN)
      COMMON /BLK/ CD10(50,50),CD20(50,50),CD30(50,50)
      NX=NN-2
      I3=NX+1
      DO 10 I1=1,NX
       DO 20 I2=2,NX
         DA10(I1,I2)=DA20(I1,I3)+DA30(I1,I2+1)
  20   CONTINUE
       DO 30 I3=2,NX
         DA20(I1,I3)=DA10(I1,I2-1)*DA40(I1,I2)
  30   CONTINUE
       DO 40 I4=3,NX+1
         DX = DIMAG(CD10(I1,I4))
         IF ( DX.GT.0.D0 ) LD10(I1,I4)=.TRUE.
         CD10(I1,I4)=CD20(I1,I4)+CD30(I1,I4)
  40   CONTINUE
       DO 50 I5=1,NX-1
         CD20(I1,I5)=CD10(I1,I5)-DCMPLX(DA10(I1,I2+1),DA20(I1+1,I2))
         DY = DIMAG(CD20(I1,I5))
         IF ( DY.GT.0.D0 ) LD20(I1,I5)=.TRUE.
  50   CONTINUE
  10  CONTINUE
       RETURN
       END
      SUBROUTINE SUB2(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      IMPLICIT  REAL*8(D),LOGICAL*4(L),COMPLEX*16(C)
      DIMENSION  DA10(NN,NN),DA20(NN,NN),DA30(NN,NN),DA40(NN,NN),
     *           LD10(NN,NN),LD20(NN,NN)
      COMMON /BLK/ CD10(50,50),CD20(50,50),CD30(50,50)
      NX=NN-2
      DO 10 I1=NX,2,-2
        CD10(I1,NX)=CD20(I1,I1)-CD30(I1,I1+1)
        DO 20 I2=2,NX
          DA10(I1-1,I2)=DA40(I1,I2)+DA30(I1,I1)
  20    CONTINUE
        DA10(I1,NX)=DA20(I1,I1)-DA30(I1,I1)
        DO 30 I2=2,I1
          DA30(I1-1,I2)=DA10(I1,I2+1)/DA20(I1,I2)
  30    CONTINUE
        IF ( LD10(I1,I1).OR.LD20(I1,2) ) THEN
          DA30(I1,NX)=DA20(I1,I1)*2.D0
        ENDIF
        DO 40 I2=2,I1
          CD30(I1,I2)=CD10(I1+1,I2)+CD20(I1,I2+1)
  40    CONTINUE
        CD20(I1,2)= CD10(I1,NX)
  10  CONTINUE
      RETURN
      END
