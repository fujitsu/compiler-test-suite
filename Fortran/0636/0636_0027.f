      PROGRAM MAIN
      IMPLICIT REAL*8(A-D),LOGICAL*4(L)
      DIMENSION  DA10(50,50),DA20(50,50),DA30(50,50),DA40(50,50),
     *           LD10(50,50),LD20(50,50)
      DATA     DA10/2500*1.0D0/,DA20/2500*2.0D0/
      DATA     DA30/2500*3.0D0/,DA40/2500*4.0D0/
      DATA     LD10/2500*.FALSE./,LD20/2500*.FALSE./
      DATA     NN/50/
      CALL  SUB1(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      CALL  SUB2(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      WRITE(6,*) 'DA10=',DA10
      WRITE(6,*) 'DA20=',DA20
      WRITE(6,*) 'DA30=',DA30
      WRITE(6,*) 'DA40=',DA40
      WRITE(6,*) 'LD10=',LD10
      WRITE(6,*) 'LD20=',LD20
      STOP
      END
      SUBROUTINE SUB1(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      IMPLICIT  REAL*8(A-D),LOGICAL*4(L)
      DIMENSION  DA10(NN,NN),DA20(NN,NN),DA30(NN,NN),DA40(NN,NN),
     *           LD10(NN,NN),LD20(NN,NN)
      DIMENSION  DW(2500)
      DATA   DW/2500*1.D0/
      NX=NN-1
      DO 10 I=1,NX
       DO 20 J=1,NX
        DA10(I,J) = DA10(I,J+1)+DFLOAT(I)
        DA20(I,J) = DA30(I,J+1)+DA40(I+1,J)
        IF ( DA10(I,J).GT.DA20(I,J) ) LD10(I,J)=.TRUE.
  20   CONTINUE
       DO 30 J=1,NX
        DA30(I+1,J)=DA10(I+1,J)+DA20(I,J)
        DA40(I,J) = DMAX1(DA40(I,J),DA20(I+1,J))
        IF ( LD10(I,J) ) THEN
          II=I+(J-1)*NN
          DW(II) = DA40(I,J)-DA30(I,J)
        ENDIF
  30   CONTINUE
  10  CONTINUE
      DO 40 I1=2,20
       DO 50 I2=2,NX,2
        DA10(I1,I2)=DA30(I1,I2)-DW(I1+I2)
        DA20(I1,I2)=DA40(I1,I2)-DW(I1+I2)
        IF (LD10(I1,I2).OR.LD20(I1,I2)) THEN
         LD10(I1,I2)=.NOT.LD20(I1,I2)
        ELSE
         LD20(I1,I2)=.NOT.LD10(I1,I2)
        ENDIF
  50   CONTINUE
       LD20(I1,3)=.TRUE.
       DA30(I1,2)=DA10(I1,5)-DA20(I1+1,3)
  40  CONTINUE
      RETURN
      END
      SUBROUTINE SUB2(DA10,DA20,DA30,DA40,LD10,LD20,NN)
      IMPLICIT  REAL*8(A-D),LOGICAL*4(L)
      DIMENSION  DA10(NN,NN),DA20(NN,NN),DA30(NN,NN),DA40(NN,NN),
     *           LD10(NN,NN),LD20(NN,NN)
      DIMENSION  DW10(2500),DW20(2500)
      DATA   DW10,DW20/2500*1.D0,2500*2.D0/
      NX=NN-1
      DO 10 I1=2,NX
       DX=DMAX1(DA40(I1,NX),DFLOAT(I1))
       DO 10 I2=2,NX
        DA10(I1,I2)=DA20(I1-1,I2)-DA30(I1,I2+1)
        DA20(I1,I2)=DA30(I1,I2+1)-DA40(I1-1,I2)
        DA30(I1,I2)=DX - DMIN1(DA10(I1,I2),DA20(I1,I2))
  10  CONTINUE
      DO 20 I1=1,NX
       DO 30 I2=1,NX
        II=NN+I2*2
        DW10(II)=DA10(I1,I2+1)-DA20(I1+1,I2)
        DW20(II)=DA30(I1,I2+1)-DA40(I1+1,I2)
        IF ( LD10(I1,I2) ) THEN
          DA20(I1,I2)=DA30(I1,I2)/DW10(II)
          DA30(I1,I2)=DA40(I1,I2)*(DW20(II)/DA10(I1,I2))
        ENDIF
  30   CONTINUE
       DO 40 I3=1,NX
        II=NN+I3*2
        DA10(I1,I3)=DA20(I1,I3)-DW10(II)
        DA40(I1,I3)=DA30(NX,I3)-DW20(II)
        IF ( DA10(I1,I3).GT.DA20(I1,I3) ) THEN
          LD10(I1,I3)=.NOT.LD10(I1,I3) .AND. LD20(I1,I2)
        ENDIF
  40   CONTINUE
  20  CONTINUE
      RETURN
      END
