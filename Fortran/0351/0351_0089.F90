program main
  real(kind=4),dimension(1:128) :: a,b,c,res
  intrinsic atan2
  call init(b,c,res,atan2)
  do i=1,2
     call test(a,b,c)
  enddo
  do i=1,128
    call check(a(i), res(i))
  enddo
  print *, "OK"
end program main

subroutine init(b,c,res,fs)
  real(kind=4),dimension(1:128) :: b,c,res
  real(kind=4) :: fs
  external :: fs
  real(kind=4),parameter :: pzero=z'0'
  real(kind=4),parameter :: mzero=z'80000000'
  real(kind=4),parameter :: pinf=z'7f800000'
  real(kind=4),parameter :: minf=z'ff800000'
  real(kind=4),parameter :: pnan=z'7fc00000'
  real(kind=4),parameter :: mnan=z'ffc00000'
  real(kind=4),parameter :: before_under=z'7f7fffff'
  real(kind=4),parameter :: under=z'7f800000'


  b(0+1) =  0.1_4; c(0+1) =  0.1_4; res(0+1) = fs( 0.1_4,  0.1_4)
  b(1+1) =  1.0_4; c(1+1) =  0.1_4; res(1+1) = fs( 1.0_4,  0.1_4)
  b(2+1) =  9.9_4; c(2+1) =  0.1_4; res(2+1) = fs( 9.9_4,  0.1_4)
  b(3+1) =  0.1_4; c(3+1) =  1.0_4; res(3+1) = fs( 0.1_4,  1.0_4)
  b(4+1) =  1.0_4; c(4+1) =  1.0_4; res(4+1) = fs( 1.0_4,  1.0_4)
  b(5+1) =  9.9_4; c(5+1) =  1.0_4; res(5+1) = fs( 9.9_4,  1.0_4)
  b(6+1) =  0.1_4; c(6+1) =  9.9_4; res(6+1) = fs( 0.1_4,  9.9_4)
  b(7+1) =  1.0_4; c(7+1) =  9.9_4; res(7+1) = fs( 1.0_4,  9.9_4)
  b(8+1) =  9.9_4; c(8+1) =  9.9_4; res(8+1) = fs( 9.9_4,  9.9_4)

  b(9 +1) =  -0.1_4; c(9 +1) =  0.1_4; res(9 +1) = fs( -0.1_4,  0.1_4)
  b(10+1) =  -1.0_4; c(10+1) =  0.1_4; res(10+1) = fs( -1.0_4,  0.1_4)
  b(11+1) =  -9.9_4; c(11+1) =  0.1_4; res(11+1) = fs( -9.9_4,  0.1_4)
  b(12+1) =  -0.1_4; c(12+1) =  1.0_4; res(12+1) = fs( -0.1_4,  1.0_4)
  b(13+1) =  -1.0_4; c(13+1) =  1.0_4; res(13+1) = fs( -1.0_4,  1.0_4)
  b(14+1) =  -9.9_4; c(14+1) =  1.0_4; res(14+1) = fs( -9.9_4,  1.0_4)
  b(15+1) =  -0.1_4; c(15+1) =  9.9_4; res(15+1) = fs( -0.1_4,  9.9_4)
  b(16+1) =  -1.0_4; c(16+1) =  9.9_4; res(16+1) = fs( -1.0_4,  9.9_4)
  b(17+1) =  -9.9_4; c(17+1) =  9.9_4; res(17+1) = fs( -9.9_4,  9.9_4)

  b(18+1) =  0.1_4; c(18+1) =  -0.1_4; res(18+1) = fs( 0.1_4,  -0.1_4)
  b(19+1) =  1.0_4; c(19+1) =  -0.1_4; res(19+1) = fs( 1.0_4,  -0.1_4)
  b(20+1) =  9.9_4; c(20+1) =  -0.1_4; res(20+1) = fs( 9.9_4,  -0.1_4)
  b(21+1) =  0.1_4; c(21+1) =  -1.0_4; res(21+1) = fs( 0.1_4,  -1.0_4)
  b(22+1) =  1.0_4; c(22+1) =  -1.0_4; res(22+1) = fs( 1.0_4,  -1.0_4)
  b(23+1) =  9.9_4; c(23+1) =  -1.0_4; res(23+1) = fs( 9.9_4,  -1.0_4)
  b(24+1) =  0.1_4; c(24+1) =  -9.9_4; res(24+1) = fs( 0.1_4,  -9.9_4)
  b(25+1) =  1.0_4; c(25+1) =  -9.9_4; res(25+1) = fs( 1.0_4,  -9.9_4)
  b(26+1) =  9.9_4; c(26+1) =  -9.9_4; res(26+1) = fs( 9.9_4,  -9.9_4)

  b(27+1) =  -0.1_4; c(27+1) =  -0.1_4; res(27+1) = fs( -0.1_4,  -0.1_4)
  b(28+1) =  -1.0_4; c(28+1) =  -0.1_4; res(28+1) = fs( -1.0_4,  -0.1_4)
  b(29+1) =  -9.9_4; c(29+1) =  -0.1_4; res(29+1) = fs( -9.9_4,  -0.1_4)
  b(30+1) =  -0.1_4; c(30+1) =  -1.0_4; res(30+1) = fs( -0.1_4,  -1.0_4)
  b(31+1) =  -1.0_4; c(31+1) =  -1.0_4; res(31+1) = fs( -1.0_4,  -1.0_4)
  b(32+1) =  -9.9_4; c(32+1) =  -1.0_4; res(32+1) = fs( -9.9_4,  -1.0_4)
  b(33+1) =  -0.1_4; c(33+1) =  -9.9_4; res(33+1) = fs( -0.1_4,  -9.9_4)
  b(34+1) =  -1.0_4; c(34+1) =  -9.9_4; res(34+1) = fs( -1.0_4,  -9.9_4)
  b(35+1) =  -9.9_4; c(35+1) =  -9.9_4; res(35+1) = fs( -9.9_4,  -9.9_4)

  b(36+1) =  pzero; c(36+1) =   1.0_4 ; res(36+1) = fs( pzero,   1.0_4 )
  b(37+1) =  1.0_4; c(37+1) =   pzero ; res(37+1) = fs( 1.0_4,   pzero )
  b(38+1) =  pzero; c(38+1) =   -1.0_4; res(38+1) = fs( pzero,   -1.0_4)
  b(39+1) =  -1.0_4; c(39+1) =  pzero ; res(39+1) = fs( -1.0_4,  pzero )

  b(40+1) =  mzero; c(40+1) =   1.0_4 ; res(40+1) = fs( mzero,   1.0_4 )
  b(41+1) =  1.0_4; c(41+1) =   mzero ; res(41+1) = fs( 1.0_4,   mzero )



  b(42+1) =  1.0_4 ; c(42+1) =  1.0_4 ; res(42+1) = fs( 1.0_4 ,  1.0_4 )

  b(43+1) =  -1.0_4; c(43+1) =  mzero ; res(43+1) = fs( -1.0_4,  mzero )

  b(44+1) =  1E38 ; c(44+1) =  1E38 ; res(44+1) = fs( 1E38 ,  1E38 )
  b(45+1) =  1E38 ; c(45+1) =  1.0_4; res(45+1) = fs( 1E38 ,  1.0_4)
  b(46+1) =  1E38 ; c(46+1) =  2E-38; res(46+1) = fs( 1E38 ,  2E-38)
  b(47+1) =  1.0_4; c(47+1) =  1E38 ; res(47+1) = fs( 1.0_4,  1E38 )
  b(48+1) =  1.0_4; c(48+1) =  1.0_4; res(48+1) = fs( 1.0_4,  1.0_4)
  b(49+1) =  1.0_4; c(49+1) =  2E-38; res(49+1) = fs( 1.0_4,  2E-38)
  b(50+1) =  2E-38; c(50+1) =  1E38 ; res(50+1) = fs( 2E-38,  1E38 )
  b(51+1) =  2E-38; c(51+1) =  1.0_4; res(51+1) = fs( 2E-38,  1.0_4)
  b(52+1) =  2E-38; c(52+1) =  2E-38; res(52+1) = fs( 2E-38,  2E-38)

  b(53+1) =  -1E38 ; c(53+1) =  1E38 ; res(53+1) = fs( -1E38 ,  1E38 )
  b(54+1) =  -1E38 ; c(54+1) =  1.0_4; res(54+1) = fs( -1E38 ,  1.0_4)
  b(55+1) =  -1E38 ; c(55+1) =  2E-38; res(55+1) = fs( -1E38 ,  2E-38)
  b(56+1) =  -1.0_4; c(56+1) =  1E38 ; res(56+1) = fs( -1.0_4,  1E38 )
  b(57+1) =  -1.0_4; c(57+1) =  1.0_4; res(57+1) = fs( -1.0_4,  1.0_4)
  b(58+1) =  -1.0_4; c(58+1) =  2E-38; res(58+1) = fs( -1.0_4,  2E-38)
  b(59+1) =  -2E-38; c(59+1) =  1E38 ; res(59+1) = fs( -2E-38,  1E38 )
  b(60+1) =  -2E-38; c(60+1) =  1.0_4; res(60+1) = fs( -2E-38,  1.0_4)
  b(61+1) =  -2E-38; c(61+1) =  2E-38; res(61+1) = fs( -2E-38,  2E-38)




  b(62+1) =  1.0_4; c(62+1) =  1.0_4 ; res(62+1) = fs( 1.0_4,  1.0_4 )

  b(63+1) =  1E38 ; c(63+1) =  -1.0_4; res(63+1) = fs( 1E38 ,  -1.0_4)
  b(64+1) =  1E38 ; c(64+1) =  -2E-38; res(64+1) = fs( 1E38 ,  -2E-38)
  b(65+1) =  1.0_4; c(65+1) =  -1E38 ; res(65+1) = fs( 1.0_4,  -1E38 )
  b(66+1) =  1.0_4; c(66+1) =  -1.0_4; res(66+1) = fs( 1.0_4,  -1.0_4)
  b(67+1) =  1.0_4; c(67+1) =  -2E-38; res(67+1) = fs( 1.0_4,  -2E-38)
  b(68+1) =  2E-38; c(68+1) =  -1E38 ; res(68+1) = fs( 2E-38,  -1E38 )
  b(69+1) =  2E-38; c(69+1) =  -1.0_4; res(69+1) = fs( 2E-38,  -1.0_4)
  b(70+1) =  2E-38; c(70+1) =  -2E-38; res(70+1) = fs( 2E-38,  -2E-38)




  b(71+1) =  1.0_4 ; c(71+1) =  1.0_4 ; res(71+1) = fs( 1.0_4 ,  1.0_4 )

  b(72+1) =  -1E38 ; c(72+1) =  -1.0_4; res(72+1) = fs( -1E38 ,  -1.0_4)
  b(73+1) =  -1E38 ; c(73+1) =  -2E-38; res(73+1) = fs( -1E38 ,  -2E-38)
  b(74+1) =  -1.0_4; c(74+1) =  -1E38 ; res(74+1) = fs( -1.0_4,  -1E38 )
  b(75+1) =  -1.0_4; c(75+1) =  -1.0_4; res(75+1) = fs( -1.0_4,  -1.0_4)
  b(76+1) =  -1.0_4; c(76+1) =  -2E-38; res(76+1) = fs( -1.0_4,  -2E-38)
  b(77+1) =  -2E-38; c(77+1) =  -1E38 ; res(77+1) = fs( -2E-38,  -1E38 )
  b(78+1) =  -2E-38; c(78+1) =  -1.0_4; res(78+1) = fs( -2E-38,  -1.0_4)
  b(79+1) =  -2E-38; c(79+1) =  -2E-38; res(79+1) = fs( -2E-38,  -2E-38)







  b(80+1) =  1.0_4 ; c(80+1) =  1.0_4 ; res(80+1) = fs( 1.0_4 ,  1.0_4 )
  b(81+1) =  1.0_4 ; c(81+1) =  1.0_4 ; res(81+1) = fs( 1.0_4 ,  1.0_4 )
  b(82+1) =  1.0_4 ; c(82+1) =  1.0_4 ; res(82+1) = fs( 1.0_4 ,  1.0_4 )
  b(83+1) =  1.0_4 ; c(83+1) =  1.0_4 ; res(83+1) = fs( 1.0_4 ,  1.0_4 )


  b(84+1) =  before_under; c(84+1) =  before_under; res(84+1) = fs( before_under,  before_under)
  b(85+1) =  before_under; c(85+1) =  1.0_4; res(85+1) = fs( before_under,  1.0_4)
  b(86+1) =  1.0_4; c(86+1) =         before_under; res(86+1) = fs( 1.0_4,         before_under)

  b(87+1) =  under; c(87+1) =  under; res(87+1) = fs( under,  under)
  b(88+1) =  under; c(88+1) =  1.0_4; res(88+1) = fs( under,  1.0_4)
  b(89+1) =  1.0_4; c(89+1) =  under; res(89+1) = fs( 1.0_4,  under)

  b(90+1) =  pinf; c(90+1) =    pinf; res(90+1) = fs( pinf,    pinf)
  b(91+1) =  pinf; c(91+1) =    1.0_4; res(91+1) = fs( pinf,    1.0_4)
  b(92+1) =  1.0_4; c(92+1) =   pinf; res(92+1) = fs( 1.0_4,   pinf)
  b(93+1) =  minf; c(93+1) =    minf; res(93+1) = fs( minf,    minf)
  b(94+1) =  minf; c(94+1) =    1.0_4; res(94+1) = fs( minf,    1.0_4)
  b(95+1) =  1.0_4; c(95+1) =   minf; res(95+1) = fs( 1.0_4,   minf)
  b(96+1) =  pinf; c(96+1) =    minf; res(96+1) = fs( pinf,    minf)
  b(97+1) =  minf; c(97+1) =    pinf; res(97+1) = fs( minf,    pinf)
  b(98+1) =  -1.0_4; c(98+1) =  pinf; res(98+1) = fs( -1.0_4,  pinf)
  b(99+1) =  -1.0_4; c(99+1) =  minf; res(99+1) = fs( -1.0_4,  minf)

  b(100+1) =  pinf; c(100+1) =   pzero; res(100+1) = fs( pinf,   pzero)
  b(101+1) =  pzero; c(101+1) =  pinf; res(101+1) = fs( pzero,  pinf)
  b(102+1) =  minf; c(102+1) =   pzero; res(102+1) = fs( minf,   pzero)
  b(103+1) =  pzero; c(103+1) =  minf; res(103+1) = fs( pzero,  minf)
  b(104+1) =  mzero; c(104+1) =  pinf; res(104+1) = fs( mzero,  pinf)



  b(105+1) =  1.0_4 ; c(105+1) =  1.0_4 ; res(105+1) = fs( 1.0_4 ,  1.0_4 )


  b(106+1) =  pnan; c(106+1) =   pnan; res(106+1) = fs( pnan,   pnan)
  b(107+1) =  pnan; c(107+1) =   1.0_4; res(107+1) = fs( pnan,   1.0_4)
  b(108+1) =  1.0_4; c(108+1) =  pnan; res(108+1) = fs( 1.0_4,  pnan)
  b(109+1) =  pnan; c(109+1) =   0.0_4; res(109+1) = fs( pnan,   0.0_4)
  b(110+1) =  0.0_4; c(110+1) =  pnan; res(110+1) = fs( 0.0_4,  pnan)

  b(106+1) =  mnan; c(106+1) =   mnan; res(106+1) = fs( mnan,   mnan)
  b(107+1) =  mnan; c(107+1) =   1.0_4; res(107+1) = fs( mnan,   1.0_4)
  b(108+1) =  1.0_4; c(108+1) =  mnan; res(108+1) = fs( 1.0_4,  mnan)
  b(109+1) =  mnan; c(109+1) =   0.0_4; res(109+1) = fs( mnan,   0.0_4)
  b(110+1) =  0.0_4; c(110+1) =  mnan; res(110+1) = fs( 0.0_4,  mnan)


  do i=111,128-1
    b(i+1) =  1._4; c(i+1) =  1._4; res(i+1) = fs( 1._4,  1._4)
  enddo
end subroutine init

subroutine check(res, fsres)

  use, intrinsic :: ieee_arithmetic

  real(kind=4) :: res, fsres
  if (fsres .eq. 0.0_4) then
     if ((res .ne.  fsres)) then



        if(.not. ieee_is_nan(res)) then
           print *, "NG"
        endif

     endif
  else
     if (((abs(res -  fsres)/abs(res)) .gt. 1.0E-7)) then
        print *, "NG"
     endif
  endif
end subroutine check
  


subroutine test(a,b,c)
  real(kind=4), dimension(1:128) :: a,b,c

  do i=1,128
     a(i) = atan2(b(i), c(i))
  enddo
end subroutine test
