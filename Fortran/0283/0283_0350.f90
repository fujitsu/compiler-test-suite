MODULE mod1
IMPLICIT NONE

TYPE t1
  REAL :: r1
END TYPE

TYPE,EXTENDS(t1) :: t2
  REAL :: r2
END TYPE

END MODULE 

PROGRAM main
USE mod1
IMPLICIT NONE

CLASS(t2),DIMENSION(:),ALLOCATABLE,TARGET :: allc
TYPE(t1) :: obj

ALLOCATE(allc(1:10))
allc%r2 = 2.0

ASSOCIATE(aa => fun(allc))
  SELECT TYPE(aa)
    TYPE IS(t2)
      obj%r1 = 1.0
  END SELECT
END ASSOCIATE

IF(obj%r1 .EQ. 1.0) THEN
  PRINT*,'pass'
ELSE
  PRINT*,101
END IF

CONTAINS

FUNCTION fun(dd1)
IMPLICIT NONE
CLASS(t1),DIMENSION(:),POINTER :: fun
CLASS(t2),DIMENSION(:),ALLOCATABLE,TARGET :: dd1
fun => dd1
END FUNCTION

END PROGRAM
